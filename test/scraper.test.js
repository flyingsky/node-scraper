var assert = require('assert');
var path = require('path');

var Scraper = require('../lib/scraper');
var Parser = Scraper.Parser;

describe('scraper', function() {
  this.timeout(1000 * 60 * 2);

  it('html', function(done) {
    var parser = new Parser(path.resolve('test/simple-parser.json'));
    var scraper = new Scraper();
    scraper.parser = parser;

    scraper.scrapePage('http://www.jufengshang.com/Longines3756', function(err, result) {
      console.log(result);

      assert(result);
      assert(result.title);
      assert(result.imgSrc);
      assert(result.description);

      done(err);
    });
  });

  it.only('html with js', function(done) {
    var parser = new Parser(path.resolve('test/simple-parser.json'));
    parser.mapping.price = '.shop_s';  // this element is generated by js

    var scraper = new Scraper();
    scraper.parser = parser;
    var uri = 'http://www.jufengshang.com/Longines3756';
    scraper.scrapePage(uri, true, function(err, result) {
      console.log(result);

      assert(result);
      assert(result.title);
      assert(result.imgSrc);
      assert(result.description);
      assert(result.price);

      done(err);
    });
  });
});